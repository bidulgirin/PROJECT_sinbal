<!-- 장바구니 페이지 -->
{% extends 'base/base.html' %} {% load static %}
<!-- 콤마를위함 -->
{% load humanize %} {% block content %}
<!-- 콘텐츠 영역 -->
<div class="container">
    <form method="POST" action="{% url 'cart' %}" id="cart_form">
        {% csrf_token %}
        <div class="row">
            <div class="col">
                <h1>장바구니 목록</h1>
                <table>
                    <tr>
                        <td>
                            <input type="checkbox" id="all_check" />
                        </td>
                        <td>상품번호</td>
                        <td>상품주문번호</td>
                        <td>이미지</td>
                        <td>발 사이즈</td>
                        <td>가격</td>
                        <td>사이즈</td>
                        <td>수량</td>
                    </tr>
                    <!-- 
                        배열값으로 받은것들 편집해서 
                        Order 모델에 주문넣은거 1개 넣고 
                        OrderItem은 제품 id
                    -->
                    {% for data in cart_datas %}
                    <tr>
                        <td>
                            <input
                                type="checkbox"
                                name="shoe_id[]"
                                id="{{data.shoe.id}}"
                                value="{{data.shoe.id}}"
                                data-price="{{data.shoe.price}}"
                            />
                        </td>
                        <td>{{data.shoe.id}}</td>
                        <td>{{data.id}}</td>
                        <td>
                            <img
                                src="{{data.shoe.image_url}}"
                                alt="{{data.shoe.name}}"
                                width="60px"
                                heihgt="60px"
                            />
                        </td>

                        <td>{{data.shoe.name}}</td>
                        <td>{{data.shoe.price|intcomma}}</td>
                        <td>{{data.size}}</td>
                        <td>{{data.quantity}}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td>장바구니가 텅 비었습니다</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="col">
                <h1>최종 결제 금액</h1>
                <table>
                    <tr>
                        <td>총 가격</td>
                        <td>
                            <input
                                id="total_price"
                                name="total_price"
                                type="text"
                                hidden
                            />
                            <p id="total_price_p"></p>
                        </td>
                    </tr>
                    <tr>
                        <td>배송비</td>
                        <td>0 원</td>
                    </tr>
                </table>
                <button class="btn btn-primary" type="submit">구매하기</button>
            </div>
        </div>
    </form>
</div>
<script>
    // all_check 체크하면 모두 체크 아니면 모두 체크 아님
    // 기본 값 모두 체크
    const all_check = document.querySelector("#all_check");
    let checkboxs = document.getElementsByName("shoe_id[]");
    function checkbox_all_check() {
        if (checkboxs.length > 0) {
            checkboxs.forEach((e) => {
                if (e.checked == true) {
                    e.checked = false;
                } else {
                    e.checked = true;
                }
            });
        }
    }
    all_check.addEventListener("click", checkbox_all_check);

    // 체크한 상품 총 가격 계산하기
    let total_price = 0;
    checkboxs.forEach((e) => {
        if (e.checked == true) {
            total_price += parseInt(e.dataset["price"]);
        }
    });

    print(total_price);
</script>
{% endblock %}
